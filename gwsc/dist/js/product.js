"use strict";requirejs.config({baseUrl:"./js/",urlArgs:"va="+(new Date).getTime(),paths:{jquery:["lib/jquery-1.11.1.min"],"jquery.validate":["lib/jquery.validate"],"additional-methods":["lib/additional-methods"],yzm:["code"],storageTools:["storageTools"],"jquery.cookie":["lib/jquery.cookie"],shim:{yzm:{deps:["jquery"]}}}}),requirejs(["jquery","storageTools","jquery.cookie"],function(r,c){var o=c.get("login"),n=JSON.parse(o||"{}");null!=n.uid?(r("#lg_btn a").text("欢迎您："+n.utel),r("#re_btn").remove()):(r("#lg_btn a").text("登录"),r(".content .logininfo_r").prepend("<li id='re_btn'><a href='#' >注册</a><span>|</span></li>")),r.ajax({url:"./../server/goodsinfo.php",dataType:"json"}).done(function(o){var t=location.search.split("=")[1];o.forEach(function(o,n){if(o.gid==t){r(".p_info h2").text(o.gName),r(".price .leftprice b").text(o.gPrice);var e="";o.mImg.forEach(function(o,n){e+=0==n?' <li class="on"><a href="#">\n                     <img src=\''+o+'\' alt="">\n                     </a></li> ':' <li><a href="#">\n                     <img src=\''+o+'\' alt="">\n                     </a></li> '}),r(".pic .pro_m").prepend(e);var s="";o.bImg.forEach(function(o,n){s+=0==n?"<img src='"+o+"' alt='' style='width: 1500px;height: 2027px' class=\"on\">":"<img src='"+o+"' alt='' style='width: 1500px;height: 2027px' >"}),r(".pic .glass").append(s),r(".jgshow").append(" <span style='font-size: 24px'>"+o.gPrice+"</span>"),e='  <a class="collect">\n                   立刻购买\n               </a>\n               <a class="add" data-info=\''+JSON.stringify(o)+"'>\n                   加入购物车\n               </a>",r(".addcart").append(e);var i="";o.indexImg.forEach(function(o,n){0==n&&(i+='  <li >\n                             <a href="#" class="on">\n                                 <img src=\''+o+'\' alt="">\n                             </a>\n                             </li>\n                              '),i+='  <li>\n                             <a href="#">\n                                 <img src=\''+o+'\' alt="">\n                             </a>\n                             </li>\n                              '}),r(".thum_list_center ul").append(i),i="",o.colors.forEach(function(o,n){i+=0==n?'\n                       <p class="selected">\n                       <span>\n                       <img src="'+o.colorImg+'" alt="">\n                       </span>\n                       <i>'+o.colorName+"</i>\n                       </p>\n                       ":'\n                       <p >\n                       <span>\n                       <img src="'+o.colorImg+'" alt="">\n                       </span>\n                       <i>'+o.colorName+"</i>\n                       </p>\n                       "}),r(".color>ul>.colork").append(i),i="",o.sizes.forEach(function(o,n){i+=0==n?'<a class="on">'+o+"</a>":"<a>"+o+"</a>"}),r(".size>ul>.txt>span").append(i)}})}),r(".color>ul>.colork").on("click","p",function(){r(this).addClass("selected").siblings("p").removeClass("selected")}),r(".size>ul>.txt>span").on("click","a",function(){r(this).addClass("on").siblings("a").removeClass("on")}),r(".size>ul>.txt>span").on("mouseenter","a",function(){r(this).css("color","#E40165").siblings("a").css("color","#333")}),r(".size>ul>.txt>span").on("mouseleave","a",function(){r(this).find("a").css("color","#333")}),r(".addcart").on("click",".add",function(){var o=r(this).data("info"),n=r(".color .selected").find("i").text(),e=r(".color .selected").find("span>img").attr("src");o.colors={colorsName:n,colorImg:e};var s=r(".size .txt").find("a[class='on']").text();if(o.sizes=[s],o.num=parseInt(r(".num p").find("b").text()),c.isLogin("login")){o.uid=JSON.parse(c.get("login")).uid,console.log(o.uid);var i={uid:o.uid,gid:o.gid,gName:o.gName,gPrice:o.gPrice,gColor:o.colors.colorsName,gSize:o.sizes[0],gColorImg:o.colors.colorImg,num:o.num};console.log(i),r.ajax({url:"./../server/cart.php",data:i,type:"post"}).then(function(o){console.log(o),alert(o.msg)})}else{var t=JSON.parse(r.cookie("cartInfo")||"[]"),a=!1,l={gid:o.gid,gName:o.gName,gPrice:o.gPrice,gColor:o.colors.colorsName,gSize:o.sizes[0],gColorImg:o.colors.colorImg,num:o.num,total:parseInt(o.gPrice)*parseInt(o.num)};console.log(t),console.log(l),t.forEach(function(o,n){o.gid==l.gid&&o.gColor==l.gColor&&o.gSize==l.gSize&&(o.num=parseInt(o.num)+parseInt(r(".num p").find("b").text()),a=!0)}),a||t.push(l),r.cookie("cartInfo",JSON.stringify(t),{expires:7}),r(".cart_ring p").text(t.length),alert("添加成功")}return!1}),setInterval(function(){if(c.isLogin("login")){var o={uid:JSON.parse(c.get("login")).uid};r.ajax({url:"./../server/cartList.php",data:o}).then(function(o){r(".cart_ring p").text(o.length)})}else{var n=JSON.parse(r.cookie("cartInfo")||"[]");r(".cart_ring p").text(n.length)}});var e=document.querySelector(".logininfo_r .cls"),s=document.querySelector(".sort");e.onmouseover=function(){s.style.display="block"},s.onmouseleave=function(){s.style.display="none"},r("body").on("mouseenter",".pro_m",function(){var e=r(".pic"),s=r(this).find(".zoom"),o=r(".glass"),i=r(".glass").find("img"),n=parseInt(r(this).height())/parseInt(i.height())*parseInt(o.height()),t=parseInt(r(this).width())/parseInt(i.width())*parseInt(o.width());s.css({width:parseInt(t),height:parseInt(n)});var a=r(this).width()/parseInt(s.width());r(".thum_list");s.css("display","block"),o.css("display","block");var l=r(this);document.onmousemove=function(o){var n=o||window.event;mx=n.clientX-e.position().left-l.position().left-parseInt(s.css("width"))/2-80,my=n.clientY-e.position().top-l.position().top-parseInt(s.css("height"))/2,mx<=0&&(mx=0),mx>=l.width()-parseInt(s.css("width"))&&(mx=l.width()-parseInt(s.css("width"))),my<=0&&(my=0),my>=l.height()-parseInt(s.css("height"))+10&&(my=l.height()-parseInt(s.css("height"))+10),s.css({left:mx,top:my}),i.css({left:-mx*a-1,top:-my*a-1})}}),r("body").on("mouseleave",".pro_m",function(){var o=r(this).find(".zoom"),n=r(".glass");document.onmousemove=null,o.css("display","none"),n.css("display","none")}),r(".codeshow .top").on("click",function(){r(".p_code").slideDown(500),r(".p_code .close").on("click",function(){r(".p_code").slideUp(500)})}),r("body").on("mouseover",".thum_list_center li",function(){return r(this).find("a").addClass("on").parents("li").siblings("li").find("a").removeClass("on"),r(".pro_m").find("li").eq(r(this).index()).addClass("on").siblings("li").removeClass("on"),r(".pic .glass").find("img").eq(r(this).index()).addClass("on").siblings("img").removeClass("on"),!1}),r(".num .add").on("click",function(){r(".num b").html(parseInt(r(".num b").html())+1)}),r(".num .remove").on("click",function(){if(1==parseInt(r(".num b").html()))return!1;r(".num b").html(parseInt(r(".num b").html())-1)}),r(window).scroll(function(){950<=r(window).scrollTop()?(r(".goodsimp").addClass("fixtop"),r(".goodsimp_addcart").show(),r(".jgshow").show(),r(".jgshow .mobilebuy").on("mouseenter",function(){r(".mobile_code_block").show(),r(".mobilebuy").css("background-image","url(img/up.png)")}),r(".jgshow .mobilebuy").on("mouseleave",function(){r(".mobile_code_block").hide(),r(".mobilebuy").css("background-image","url(img/down.png)")})):(r(".goodsimp").removeClass("fixtop"),r(".goodsimp_addcart").hide(),r(".jgshow").hide())}),r(".goodsimp>h2>a").on("click",function(){r(this).addClass("on").siblings("a").removeClass("on"),r(".fcontainer .items").eq(r(this).index()).addClass("on").siblings("div").removeClass("on"),console.log(r(this).index())})});