"use strict";requirejs.config({baseUrl:"./js/",urlArgs:"va="+(new Date).getTime(),paths:{jquery:["lib/jquery-1.11.1.min"],"jquery.validate":["lib/jquery.validate"],"additional-methods":["lib/additional-methods"],yzm:["code"],storageTools:["storageTools"],"jquery.cookie":["lib/jquery.cookie"],shim:{yzm:{deps:["jquery"]}}}}),requirejs(["jquery","storageTools","jquery.cookie"],function(r,s){var n=s.get("login"),t=JSON.parse(n||"{}");if(s.isLogin("login")){r("#lg_btn").text(t.utel),r("#re_btn").remove(),r("#line").remove();var i={uid:t.uid};r.ajax({url:"./../server/cartList.php",data:i}).then(function(s){c(s),console.log(s)}),r("body").on("click",".minus",function(){var s=d(r(this));r.ajax({url:"./../server/cartList.php",data:s,dataType:"post"})}),r("body").on("click",".add",function(){var s=o(r(this));r.ajax({url:"./../server/cartList.php",data:s,dataType:"post"})}),r("body").on("click",".cz .J_del",function(){var s=a(r(this));r.ajax({url:"./../server/del.php",data:s,type:"post"})})}else{var e=JSON.parse(r.cookie("cartInfo")||"[]");c(e),r("body").on("click",".minus",function(){var t=d(r(this));e.forEach(function(s,n){s.gid==t.gid&&s.gSize==t.gSize&&s.gColor==t.gColor&&(s.num=t.num,s.total=t.total)}),r.cookie("cartInfo",JSON.stringify(e),{expires:7})}),r("body").on("click",".add",function(){var t=o(r(this));e.forEach(function(s,n){s.gid==t.gid&&s.gSize==t.gSize&&s.gColor==t.gColor&&(s.num=t.num,s.total=t.total)}),r.cookie("cartInfo",JSON.stringify(e),{expires:7})}),r("body").on("click",".cz .J_del",function(){var t=a(r(this)),i=-1;e.forEach(function(s,n){s.gid==t.gid&&s.gSize==t.gSize&&s.gColor==t.gColor&&(i=n)}),e.splice(i,1),r.cookie("cartInfo",JSON.stringify(e),{expires:7})})}function a(s){s.parents("dl").remove();var n=s.parents("dl").data("info"),t=s;if(s.parents("dd").siblings("dt").find("input").prop("checked")){var i=t.parents("dd").siblings("dd[class='dj']").find("i").text(),e=t.parents("dd").siblings("dd[class='sl clearfix']").find("input").val();r(".zs .pics").text(parseInt(r(".zs .pics").text())-e),r(".howmuch").text(parseInt(r(".howmuch").text())-parseInt(i)*e)}return n}function c(s){var i="";s.forEach(function(s,n){var t=parseInt(s.num)*parseInt(s.gPrice);i+='<dl class="top" data-info=\''+JSON.stringify(s)+'\'>\n            <dt>\n            <input   class="chkalls" name="J_checkboxs" type="checkbox">\n            </dt>\n            <dd class="sp">\n            <span class="left">\n            <a href="">\n            <img src=\''+s.gColorImg+'\' width="39" height="53">\n            </a>\n            </span>\n            <span class="right">\n            <span class="spmc">\n            <a href="" class="goods-link" target="_blank">'+s.gName+'</a>\n        </span>\n        <span class="zhiliao"> 品牌：所然　尺寸\''+s.gSize+" 颜色：<i>"+s.gColor+'</i> </span>\n        </span>\n        </dd>\n        <dd class="dj">\n            <p class="price">\n            <span class="price-icon">￥</span><i>'+s.gPrice+'</i>\n            </p>\n            </dd>\n            <dd class="sl clearfix">\n            <a href="javascript:void(0)" class="J_minus minus">-</a>\n            <input class="J_num num" data-warecode="180918401-M03XS" data-kitorder="0" type="text" value=\''+s.num+'\' data-qty="1">\n            <a href="javascript:void(0)" class="J_add add">+</a>\n            </dd>\n            <dd class="jexj">\n            <span class="price-icon" data-info=\''+t+"'>￥</span><i>"+t+'</i>\n            </dd>\n            <dd class="cz">\n           \n            <p class="shanchu">\n            <span class="J_del operation">\n            移除\n            </span>\n            </p>\n            </dd>\n            </dl>'}),r(".nr").append(i)}function d(s){if(1==s.siblings("input").val())return!1;s.siblings("input").val(s.siblings("input").val()-1);var n=s.parents("dd").siblings("dd[class='dj']").find("i").text(),t=parseInt(s.siblings("input").val())*parseInt(n);s.parents("dd").siblings("dd[class='jexj']").find("i").text(t);var i=s.parents("dl").data("info");i.num=s.siblings("input").val(),i.total=t;var e=s;return s.parents("dd").siblings("dt").find("input").prop("checked")&&(r(".zs .pics").text(parseInt(r(".zs .pics").text())-1),r(".howmuch").text(parseInt(r(".howmuch").text())-parseInt(e.parents("dd").siblings("dd[class='dj']").find("i").text()))),i}function o(s){s.siblings("input").val(parseInt(s.siblings("input").val())+1);var n=s.parents("dd").siblings("dd[class='dj']").find("i").text(),t=parseInt(s.siblings("input").val())*parseInt(n);s.parents("dd").siblings("dd[class='jexj']").find("i").text(t);var i=s.parents("dl").data("info");i.num=s.siblings("input").val(),i.total=t;var e=s;return s.parents("dd").siblings("dt").find("input").prop("checked")&&(r(".zs .pics").text(parseInt(r(".zs .pics").text())+1),r(".howmuch").text(parseInt(r(".howmuch").text())+parseInt(e.parents("dd").siblings("dd[class='dj']").find("i").text()))),i}r("body").on("click","#chkall",function(){if(console.log(r(this).is(":checked")),r(".nr .chkalls").prop("checked",r(this).is(":checked")),r(this).is(":checked")){var t=0;r(".num").each(function(s,n){t+=parseInt(n.value)});var i=0;r(".nr .jexj .price-icon").each(function(s,n){i+=parseInt(r(n).attr("data-info"))}),r(".zs .pics").text(t+"件"),r(".howmuch").text(i),r(".toSettlement").css("background","#EB0067")}else r(".zs .pics").text("0件"),r(".howmuch").text("0.00"),r(".toSettlement").css("background","#D9D9D9")}),r("body").on("click",".nr :checkbox",function(){var s=r(".nr :checkbox").length,n=r(".nr :checkbox:checked").length;r("#chkall").prop("checked",s==n),1<=n?r(".toSettlement").css("background","#EB0067"):r(".toSettlement").css("background","#D9D9D9");var t=r(this);if(r(this).prop("checked")){var i=parseInt(t.parents("dt").siblings("dd[class='sl clearfix']").find(".num").val()),e=t.parents("dt").siblings("dd[class='jexj']").find("i").text();r(".zs .pics").text(i+parseInt(r(".zs .pics").text())),r(".howmuch").text(parseInt(e)+parseInt(r(".howmuch").text()))}else{var a=parseInt(t.parents("dt").siblings("dd[class='sl clearfix']").find(".num").val()),c=t.parents("dt").siblings("dd[class='jexj']").find("i").text();r(".zs .pics").text(parseInt(r(".zs .pics").text())-a),r(".howmuch").text(parseInt(r(".howmuch").text())-parseInt(c))}})});